- [1.2.1 准备工作](#121-准备工作)
- [1.2.2 开发环境搭建](#122-开发环境搭建)
  - [1.2.2.1 SDK](#1221-sdk)
  - [1.2.2.2 工具包](#1222-工具包)
  - [1.2.2.3 Espressif IDF插件](#1223-espressif-idf插件)
- [1.2.3 实验](#123-实验)
  - [1.2.3.1 新建一个工程](#1231-新建一个工程)
  - [1.2.3.2 编译\&下载\&监控一个工程](#1232-编译下载监控一个工程)
  - [1.2.3.3 代码补全及函数跳转](#1233-代码补全及函数跳转)

# 1.2.1 准备工作
目前，ESP32-C3是乐鑫新推出的一款 WiFI&BLE 5.0 SoC芯片，要想实现ESP32-C3的`代码编辑`、`程序编译`、`固件烧写`以及`软件的功能调试仿真`。我们需要提前下载下述的工具：

1. [Visual Studio Code](https://code.visualstudio.com/)
   
   主要用于代码地编辑和编译，以及固件地烧录和调试仿真
2. Espressif IDF插件
    
    在VS Code的插件市场中输入<code>Espressif IDF</code>，便可以直接下载；其出自于乐鑫官方之手，大大方便了工程师基于乐鑫芯片的开发；小编在写这篇文章时，该插件的版本为v0.6.1，如果后续有新的版本则使用最新的版本

    ![](https://docdisk.wireless-tech.cn/img/2021/10/18/Espressif_IDF_extension_20211018230411273905.png)

3. <span id="Git">[Git](https://git-scm.com/downloads)</span>

    用于下载乐鑫的SDK以及对应的工具，同时它也是一个很好版本管理以及协同合作的工具，安装最新版本的即可；

4. [Microsoft Visual C++ Build Tools](https://visualstudio.microsoft.com/downloads/)

    如果安装相关软件时，出现下述错误：
    > error: Microsoft Visual C++ 14.0 is required. 

    这个时候就需要安装这个软件，否则不需要；

    ![](https://docdisk.wireless-tech.cn/img/2021/10/18/Build_Tools_For_Visual_Studio_2019_20211018230556282674.png)


# 1.2.2 开发环境搭建
## 1.2.2.1 SDK
  - 步骤1，在任何你想要存放SDK的位置，**单击鼠标右键并选中Git Bash Here（前提是已经安装了Git工具）**，

    ![](https://docdisk.wireless-tech.cn/img/2021/10/18/Git_Bash_here_20211018230706867167.png)

  - 步骤2，然后根据自己的实际情况，键入下述的任何一条命令：

    - 下载最新版本
      
      > git clone --recursive https://github.com/espressif/esp-idf.git

    - 下载指定的稳定版本
      
      > git clone -b v4.2 --recursive https://github.com/espressif/esp-idf.git
      
      这里小编是仅以v4.2版本为例

  - 步骤3 **（可选）**，子模块更新
      
      下载完SDK之后，还需要对子模块进行更新；那么如何判断是否有子模块呢？我们可以在SDK目录查看是否有<code>.gitmodules</code>文件；如果有，则还需要键入以下命令：
      > git submodule update --init --recursive --progress
  
  - 步骤4 **（可选）**，SDK更新

      该命令仅对从master分支下载的SDK有效，在当前SDK的路径下依次键入下述的命令：
      > git checkout master\
      git pull\
      git submodule update --init --recursive      

## 1.2.2.2 工具包
当将SDK下载下来之后，我们还需要下载对应的工具才能实现`编译`、`下载`以及`调试仿真`；由于是以ESP32-C3为主题来讲解，所以这里其他ESP32型号对应的工具就不用下载了，具体的步骤如下：
- <span id="step1">步骤1</span>，在系统环境变里中增加工具包的存放路径，如下：
  > 变量名：**IDF_TOOLS_PATH**
    变量值：**F:\Tools\Espressif\IDF_Tools\ .espressif**
  
  其中变量名不可改变，但是对应的路径可以根据自己的情况不同而不同
  ![](https://docdisk.wireless-tech.cn/img/2022/09/11/IDF_TOOLS_PATH_20220911195822485689.png)
- 步骤2，设置工具包在国内服务器的下载路径，否则下载速度会很慢
  > 变量名：**IDF_GITHUB_ASSETS**
    变量值：**dl.espressif.com/github_assets**

  ![](https://docdisk.wireless-tech.cn/img/2022/09/11/IDF_GITHUB_ASSETS_20220911195828018568.png)

- 步骤3，在通过Git下载下来的SDK根目录下，打开**Powershell.exe**以便路径可以切换到SDK的根目录

  ![](https://docdisk.wireless-tech.cn/img/2022/09/11/powershell_esp_idf_20220911163856593503.gif)

- 步骤4，然后在步骤3中打开的powershell窗口，键入如下命令：
  > .\install.ps1 esp32c3 

  ![](https://docdisk.wireless-tech.cn/img/2022/09/11/install_esp32c3_20220911200549440062.gif)

- <span id="step5">步骤5</span>，在步骤4之后，先不要关闭powershell窗口，继续键入如下命令：
  > .\export.ps1

  紧接着就会输出不同工具的路径，此时仍然先不要关闭powershell窗口，下述章节会用到这些内容，如下图所示：
  ![](https://docdisk.wireless-tech.cn/img/2022/09/11/export_psl_20220911213644429138.png)

如果上述的操作正确，那么ESP32-C3的相关工具包，就会很快被安装下载到你指定的目录下:

![](https://docdisk.wireless-tech.cn/img/2022/09/11/idf_tool_path_20220911211115828612.png) 

## 1.2.2.3 Espressif IDF插件
在VSCode中进行开发ESP32-C3之前，需要对Espressif IDF插件进行配置，主要需要修改的地方如下：

- idf.adapterTargetName

  该参数主要配置目标设备，如<code>esp32</code>、<code>esp32s2</code>、<code>esp32c3</code>、<code>esp32s3</code>；选择esp32c3即可，如下图所示：
  ![](https://docdisk.wireless-tech.cn/img/2022/09/11/adapter_target_name_esp32c3_20220911212812557271.png)

- idf.customExtraPaths

  ![](https://docdisk.wireless-tech.cn/img/2022/09/11/idf_custom_extra_paths_20220911223842951562.png)
  
  该参数主要是在VSCode中，提前将上述安装的各个配置工具包的路径添加到系统环境变量**PATH**，当然你可以直接将各个配置工具包的路径，分别添加到你电脑的系统环境变量**PATH**上，只不过Espressif IDF插件在执行相关的操作时，是优先调用<code>idf.customExtraPaths</code>中的内容；那么，应该如何填充这些内容呢？也就是上面[步骤5](#step5)提及的内容；那么，知道了有哪些工具之后，我们就将这些工具的路径填充到<code>idf.customExtraPaths</code>，以下是小编配置工具包的路径内容 **（请勿直接复制下述内容，其仅表示当前小编的工具包路径，后续应随着工具的升级而做出相应的修改）**：

  ```
  F:\BLE_WIFI\Espressif\SDK\esp-idf\components\esptool_py\esptool;F:\BLE_WIFI\Espressif\SDK\esp-idf\components\app_update;F:\BLE_WIFI\Espressif\SDK\esp-idf\components\espcoredump;F:\BLE_WIFI\Espressif\SDK\esp-idf\components\partition_table;F:\Tools\Espressif\IDF_Tools\.espressif\tools\riscv32-esp-elf-gdb\11.2_20220823\riscv32-esp-elf-gdb\bin;F:\Tools\Espressif\IDF_Tools\.espressif\tools\riscv32-esp-elf\esp-2022r1-11.2.0\riscv32-esp-elf\bin;F:\Tools\Espressif\IDF_Tools\.espressif\tools\cmake\3.24.0\bin;F:\Tools\Espressif\IDF_Tools\.espressif\tools\openocd-esp32\v0.11.0-esp32-20220706\openocd-esp32\bin;F:\Tools\Espressif\IDF_Tools\.espressif\tools\ninja\1.10.2\;F:\Tools\Espressif\IDF_Tools\.espressif\tools\idf-exe\1.0.3\;F:\Tools\Espressif\IDF_Tools\.espressif\tools\ccache\4.6.2\ccache-4.6.2-windows-x86_64;F:\Tools\Espressif\IDF_Tools\.espressif\python_env\idf5.1_py3.9_env\Scripts;F:\BLE_WIFI\Espressif\SDK\esp-idf\tools;
  ```

  当填充完成之后，再打开全局的`Setting`，看看格式符不符合JSON格式：
  
  ![](https://docdisk.wireless-tech.cn/img/2022/09/11/global_setting_extrapaths_20220911232418647822.png)

  ```json
  "idf.customExtraPaths": "F:\\BLE_WIFI\\Espressif\\SDK\\esp-idf\\components\\esptool_py\\esptool;F:\\BLE_WIFI\\Espressif\\SDK\\esp-idf\\components\\app_update;F:\\BLE_WIFI\\Espressif\\SDK\\esp-idf\\components\\espcoredump;F:\\BLE_WIFI\\Espressif\\SDK\\esp-idf\\components\\partition_table;F:\\Tools\\Espressif\\IDF_Tools\\.espressif\\tools\\riscv32-esp-elf-gdb\\11.2_20220823\\riscv32-esp-elf-gdb\\bin;F:\\Tools\\Espressif\\IDF_Tools\\.espressif\\tools\\riscv32-esp-elf\\esp-2022r1-11.2.0\\riscv32-esp-elf\\bin;F:\\Tools\\Espressif\\IDF_Tools\\.espressif\\tools\\cmake\\3.24.0\\bin;F:\\Tools\\Espressif\\IDF_Tools\\.espressif\\tools\\openocd-esp32\\v0.11.0-esp32-20220706\\openocd-esp32\\bin;F:\\Tools\\Espressif\\IDF_Tools\\.espressif\\tools\\ninja\\1.10.2\\;F:\\Tools\\Espressif\\IDF_Tools\\.espressif\\tools\\idf-exe\\1.0.3\\;F:\\Tools\\Espressif\\IDF_Tools\\.espressif\\tools\\ccache\\4.6.2\\ccache-4.6.2-windows-x86_64;F:\\Tools\\Espressif\\IDF_Tools\\.espressif\\python_env\\idf5.1_py3.9_env\\Scripts;F:\\BLE_WIFI\\Espressif\\SDK\\esp-idf\\tools;",
  ```
  
- idf.customExtraVars

  ![](https://docdisk.wireless-tech.cn/img/2022/09/11/idf_custom_extra_vars_20220911233318241734.png)

  该参数主要是配置工具包中所需要的一些自定义环境变量值，同样的你可以将自定义环境变量值添加到你电脑的系统环境中，只不过Espressif IDF插件在执行相关的操作时，是优先调用<code>idf.customExtraVars</code>中的内容，如下是小编的内容 **（请勿直接复制下述内容，其仅表示当前小编的路径，后续应随着工具的升级而做出相应的修改）**：
  ```
  {"OPENOCD_SCRIPTS":"F:/Tools/Espressif/IDF_Tools/.espressif/tools/openocd-esp32/v0.10.0-esp32-20210902/openocd-esp32/share/openocd/scripts","IDF_CCACHE_ENABLE":"1"}
  ```

  同理，当填充完成之后，再打开全局的`Setting`，看看格式符不符合JSON格式： 

  ```json
  "idf.customExtraVars": "{\"OPENOCD_SCRIPTS\":\"F:/Tools/Espressif/IDF_Tools/.espressif/tools/openocd-esp32/v0.10.0-esp32-20210902/openocd-esp32/share/openocd/scripts\",\"IDF_CCACHE_ENABLE\":\"1\"}",
  ```

- idf.espIdfPath

  这里填充ESP-IDF的路径，但是该参数只针对Linux和Mac OS；所以，如果不是这两个系统之一，则可以不填；

- idf.espIdfPathWin

  ![](https://docdisk.wireless-tech.cn/img/2022/09/11/esp_idf_path_win_20220911234254409869.png)

  这里填充ESP-IDF的路径，但是该参数只针对Windows系统，以下是小编的路径：
  > F:\BLE_WIFI\Espressif\SDK\esp-idf-c3

- idf.flashType

  该参数是配置下载固件时，是选择<code>UART</code>还是<code>JTAG</code>接口； **注意：ESP32-C3芯片只支持JTAG接口，不支持SWD接口**；以下是小编的配置：

  ![](https://docdisk.wireless-tech.cn/img/2022/09/11/idf_flash_type_20220911234405324423.png)


- idf.openOcdConfigs

  该参数主要是配置OpenOcd，用于下载以及调试ESP32-C3，我们需要在代码工程中的<code>settings.json</code>配置相关的参数，有两种方式：
  1. 外置的JTAG，如`ESP-Prog`

      ```json
      "idf.openOcdConfigs": [    
        "board/esp32c3-ftdi.cfg"
      ]
      ```

      上述是使用外部的ESP-Prog调试仿真器的配置；
  
  2. ESP32-C3内嵌的USB-JTAG

      ```json
      "idf.openOcdConfigs": [
        "board/esp32c3-builtin.cfg"
      ]
      ```
      ESP32-C3内嵌有JTAG调试仿真器，无须额外的调试仿真器也可实现调试仿真；
- idf.port

  该参数用于选择连接ESP32-C3的串口号，仅对Linux和Mac OS有效；

- idf.portWin

  该参数用于选择连接ESP32-C3的串口号，仅对Windows OS有效；如果是采用JTAG下载则不需要填充该参数；

- idf.pythonBinPath

  该参数用于配置工具包中Python工具的路径，仅对Linux和Mac OS有效；

- idf.pythonBinPathWin

  该参数用于配置工具包中Python工具的路径，仅对Windows OS有效；以下是小编的路径：
  > F:\Tools\Espressif\IDF_Tools\.espressif\python_env\idf5.1_py3.9_env\Scripts\python.exe

- idf.toolsPath

  该参数用于配置工具包的路径，仅对Linux和Mac OS有效；

- idf.toolsPathWin

  该参数用于配置工具包的路径，仅对Windows OS有效；[步骤1](#step1)已经将路径添加到电脑的系统环境中了，以下是小编电脑中新添的**IDF_TOOLS_PATH**系统环境变量

  ![](https://docdisk.wireless-tech.cn/img/2022/09/11/idf_tools_environment_variable_20220911234919318450.png)

  所以，该参数的填充如下：
  > ${env:IDF_TOOLS_PATH}

除了上述提及的参数，其他的参数暂时保持默认；如有必要，再根据具体的应用做出相对应的更改。

# 1.2.3 实验
通过上述的[1.2.2 开发环境搭建](#122-开发环境搭建)之后，如果没有配置错误，那么这个时候基本上是可以在VSCode中使用**Espressif IDF插件**的所有功能；以下小编给大家显示常见的几个功能：

## 1.2.3.1 新建一个工程
为了新建一个，我们首先打开<code>VSCode</code>，然后按下<code>F1</code>-><code>ESP-IDF:Show Examples Projects</code>，然后选择一个你想要创建的工程，这里小编以**Blink**这个工程为例：
![](https://docdisk.wireless-tech.cn/img/2022/09/12/new_project_20220912120821018719.gif)

## 1.2.3.2 编译&下载&监控一个工程
有了工程之后，我们就可以在VSCode中利用**Espressif IDF插件**编译、下载以及打印Log信息，这里小编还是以**Blink**这个工程为例：
![](https://docdisk.wireless-tech.cn/img/2022/09/12/idf_build_flash_monitor_20220912120938923469.gif)

## 1.2.3.3 代码补全及函数跳转
如果我们没有进行对应的配置的话，打开一个工程会看到很多的**波浪线**以及当点击函数名时，不会发生跳转；这个时候就需要我们在**代码工程**中的<code>c_cpp_properties.json</code>进行配置，以下是小编的配置：

```json
{
  "configurations": [
    {
      "name": "ESP-IDF",
      "compilerPath": "${default}",
      "cStandard": "c11",
      "cppStandard": "c++17",
      "compileCommands": "${workspaceFolder}/build/compile_commands.json",
      "includePath": [
        "${config:idf.espIdfPath}/components/**",
        "${config:idf.espIdfPathWin}/components/**",
        "${workspaceFolder}/**"
      ],
      "browse": {
        "path": [
          "${config:idf.espIdfPath}/components",
          "${config:idf.espIdfPathWin}/components",
          "${workspaceFolder}"
        ],
        "limitSymbolsToIncludedHeaders": false
      }
    }
  ],
  "version": 4
}
```

其中，上述提及到的<code>compileCommands</code>，其对应的值只有编译工程之后，才会生成对应的<code>compile_commands.json</code>文件；经过上述的配置之后，此时代码补码以及函数跳转就可以正常工作了，以下是小编的操作：

![](https://docdisk.wireless-tech.cn/img/2022/09/12/code_complement_func_jumping_20220912122338507541.gif)

至此，所有开发必备的功能 **（包括选择串口号、GUI配置工具、单独编译及下载等功能）** 均可以直接在VSCode中完美地运行；至于如何使用JTAG对ESP32-C3下载以及调试，我们在下一篇章中介绍讲解。





